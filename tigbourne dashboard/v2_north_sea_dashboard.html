<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>North Sea Track - Enhanced Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 300;
        }
        
        .dashboard-subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .excel-controls {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-input-label {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .file-input-label:hover {
            background: #218838;
        }
        
        .download-btn, .refresh-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .download-btn:hover, .refresh-btn:hover {
            background: #0056b3;
        }
        
        .status-indicator {
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-connected {
            background: #d4edda;
            color: #155724;
        }
        
        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .tab-navigation {
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            overflow-x: auto;
        }
        
        .tab-button {
            background: none;
            border: none;
            padding: 20px 30px;
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab-button:hover {
            color: #495057;
            background: #e9ecef;
        }
        
        .tab-button.active {
            color: #3498db;
            border-bottom-color: #3498db;
            background: white;
        }
        
        .tab-content {
            display: none;
            padding: 40px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .excel-info {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .excel-info h4 {
            color: #004085;
            margin-bottom: 10px;
        }
        
        .excel-info p {
            color: #004085;
            margin-bottom: 5px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.3);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .excel-table th {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .excel-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }
        
        .excel-table tr:hover {
            background: #f8f9fa;
        }
        
        .edit-btn, .research-btn {
            background: #ffc107;
            color: #212529;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .edit-btn:hover, .research-btn:hover {
            background: #e0a800;
        }
        
        .research-btn {
            background: #17a2b8;
            color: white;
        }
        
        .research-btn:hover {
            background: #138496;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .priority-high {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .priority-medium {
            background: #fef3c7;
            color: #d97706;
        }
        
        .priority-low {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .oor-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            text-align: center;
        }
        
        .oor-excellent {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .oor-good {
            background: #fef3c7;
            color: #d97706;
        }
        
        .oor-limited {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .oor-poor {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .company-name-cell, .intern-name-cell, .field-name-cell, .contact-name-cell {
            font-weight: 600;
            color: #2563eb;
            cursor: pointer;
        }
        
        .company-name-cell:hover, .intern-name-cell:hover, .field-name-cell:hover, .contact-name-cell:hover {
            text-decoration: underline;
        }
        
        .workload-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .workload-balanced {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .workload-overloaded {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .workload-focus {
            background: #fef3c7;
            color: #d97706;
        }
        
        .intern-profile-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .company-profile-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #e74c3c;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }
        
        .detail-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .detail-label {
            font-weight: 600;
            color: #495057;
        }
        
        .detail-value {
            color: #212529;
            text-align: right;
            max-width: 60%;
            word-wrap: break-word;
        }
        
        .clickable-link {
            color: #007bff;
            text-decoration: none;
        }
        
        .clickable-link:hover {
            text-decoration: underline;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            min-width: 200px;
        }
        
        .filter-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .filter-btn:hover {
            background: #218838;
        }
        
        .intern-workload-visual {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .workload-bar {
            width: 100px;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .workload-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .workload-low { background: #28a745; }
        .workload-medium { background: #ffc107; }
        .workload-high { background: #dc3545; }
        
        .file-template {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .template-title {
            color: #856404;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .template-columns {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <div class="dashboard-title">🛢️ North Sea Track</div>
                <div class="dashboard-subtitle">Tigbourne Capital | Enhanced Investment Dashboard</div>
            </div>
            <div style="text-align: right; opacity: 0.8;">
                <div>Excel Integration</div>
                <div id="lastUpdated">Ready for Upload</div>
            </div>
        </div>
        
        <!-- Excel Controls -->
        <div class="excel-controls">
            <div class="file-input-wrapper">
                <input type="file" id="excelFile" accept=".xlsx,.xls" />
                <label for="excelFile" class="file-input-label">
                    📂 Upload North Sea Database
                </label>
            </div>
            
            <button class="refresh-btn" onclick="refreshData()" id="refreshBtn" disabled>
                🔄 Refresh Data
            </button>
            
            <button class="download-btn" onclick="downloadExcel()">
                💾 Download Updated Excel
            </button>
            
            <div id="fileStatus" class="status-indicator status-disconnected">
                Upload your Excel file to begin
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="showTab('overview')">
                📊 Overview & Summary
            </button>
            <button class="tab-button" onclick="showTab('companies')">
                🏢 Companies Research
            </button>
            <button class="tab-button" onclick="showTab('interns')">
                👥 Team Management
            </button>
            <button class="tab-button" onclick="showTab('fields')">
                🛢️ Oil Fields
            </button>
            <button class="tab-button" onclick="showTab('contacts')">
                📞 Contact Database
            </button>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- Excel File Templates Info -->
            <div class="file-template">
                <div class="template-title">📋 Enhanced North Sea Database Structure</div>
                <p style="margin-bottom: 15px; color: #856404;">Your Excel file should contain these sheets with the following columns:</p>
                
                <div style="margin-bottom: 15px;">
                    <strong>Sheet 1: "Companies"</strong>
                    <div class="template-columns">
                        <div>• Company_Name</div>
                        <div>• Production_BBL</div>
                        <div>• Ownership</div>
                        <div>• Recent_MA</div>
                        <div>• Priority</div>
                        <div>• Assigned_To</div>
                        <div>• Proposal_Status</div>
                        <div>• Investment_Thesis</div>
                        <div>• Next_Steps</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Sheet 2: "Interns"</strong>
                    <div class="template-columns">
                        <div>• Name</div>
                        <div>• Total_Companies</div>
                        <div>• Total_Fields</div>
                        <div>• Proposals_Done</div>
                        <div>• Workload_Status</div>
                        <div>• Specialization</div>
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Sheet 3: "Oil_Fields"</strong>
                    <div class="template-columns">
                        <div>• Field Name</div>
                        <div>• Operator & Partners</div>
                        <div>• Location</div>
                        <div>• Gross Production</div>
                        <div>• API Gravity</div>
                        <div>• BHT</div>
                        <div>• Water Cut</div>
                        <div>• Lifting Costs</div>
                        <div>• OOR Applicability</div>
                        <div>• Strategic Value</div>
                    </div>
                </div>
                
                <div>
                    <strong>Sheet 4: "Contacts"</strong>
                    <div class="template-columns">
                        <div>• Name</div>
                        <div>• Company</div>
                        <div>• Position</div>
                        <div>• Email</div>
                        <div>• Phone</div>
                        <div>• LinkedIn</div>
                        <div>• Notes</div>
                    </div>
                </div>
            </div>
            
            <div class="excel-info" id="fileInfo" style="display: none;">
                <h4>📊 Excel File Information</h4>
                <p id="fileName"></p>
                <p id="fileSize"></p>
                <p id="sheetsInfo"></p>
            </div>
            
            <!-- Enhanced Metrics Display -->
            <div class="metrics-grid" id="metricsGrid">
                <div class="metric-card">
                    <div class="metric-number" id="totalCompanies">12</div>
                    <div class="metric-label">Total Companies</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="totalFields">28</div>
                    <div class="metric-label">Total Oil Fields</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="assignedCompanies">10</div>
                    <div class="metric-label">Assigned Companies</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="proposalsDone">7</div>
                    <div class="metric-label">Proposals Done</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="completionRate">58%</div>
                    <div class="metric-label">Completion Rate</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="oorCandidates">15</div>
                    <div class="metric-label">OOR Candidates</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="totalContacts">45</div>
                    <div class="metric-label">Industry Contacts</div>
                </div>
                <div class="metric-card">
                    <div class="metric-number" id="highPriorityDeals">8</div>
                    <div class="metric-label">High Priority Deals</div>
                </div>
            </div>
        </div>
        
        <!-- Enhanced Companies Tab -->
        <div id="companies" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>🏢 Companies Research Database</h3>
                <button class="btn btn-primary" onclick="showAddCompanyModal()">
                    ➕ Add New Company
                </button>
            </div>
            
            <div class="filter-controls">
                <input type="text" id="companySearch" class="filter-input" placeholder="Search companies..." onkeyup="filterCompanies()">
                <select id="priorityFilter" class="filter-input" onchange="filterCompanies()">
                    <option value="">All Priorities</option>
                    <option value="High">High Priority</option>
                    <option value="Medium">Medium Priority</option>
                    <option value="Low">Low Priority</option>
                </select>
                <button class="filter-btn" onclick="clearCompanyFilters()">Clear Filters</button>
            </div>
            
            <table class="excel-table" id="companiesTable">
                <thead>
                    <tr>
                        <th>Company Name</th>
                        <th>Production (BBL/d)</th>
                        <th>Ownership</th>
                        <th>Priority</th>
                        <th>Assigned To</th>
                        <th>Proposal Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="companiesTableBody">
                    <!-- Demo data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Enhanced Interns Tab -->
        <div id="interns" class="tab-content">
            <h3 style="margin-bottom: 20px;">👥 Team Management & Workload</h3>
            
            <!-- Team Overview Cards -->
            <div class="detail-grid" id="internProfiles">
                <!-- Dynamic intern profile cards will be generated here -->
            </div>
            
            <h4 style="margin: 30px 0 20px 0;">Team Assignment Table</h4>
            <table class="excel-table" id="internsTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Companies</th>
                        <th>Fields</th>
                        <th>Proposals Done</th>
                        <th>Workload Visual</th>
                        <th>Specialization</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="internsTableBody">
                    <!-- Demo data will be populated here -->
                </tbody>
            </table>
        </div>
        
        <!-- Enhanced Oil Fields Tab -->
        <div id="fields" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>🛢️ North Sea Oil Fields Database</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="showAddFieldModal()">
                        ➕ Add New Field
                    </button>
                    <button class="btn" style="background: #28a745; color: white;" onclick="filterOORCandidates()">
                        🎯 OOR Candidates
                    </button>
                    <button class="btn" style="background: #dc3545; color: white;" onclick="filterHighWaterCut()">
                        💧 High Water Cut
                    </button>
                    <button class="btn" style="background: #6f42c1; color: white;" onclick="showAllFields()">
                        📊 Show All
                    </button>
                </div>
            </div>
            
            <div class="filter-controls">
                <input type="text" id="fieldSearch" class="filter-input" placeholder="Search fields..." onkeyup="filterFields()">
                <select id="apiFilter" class="filter-input" onchange="filterFields()">
                    <option value="">All API Gravity</option>
                    <option value="high">High API (>30°)</option>
                    <option value="medium">Medium API (20-30°)</option>
                    <option value="low">Low API (<20°)</option>
                </select>
                <button class="filter-btn" onclick="clearFieldFilters()">Clear Filters</button>
            </div>
            
            <!-- Fields Summary Cards -->
            <div class="metrics-grid" style="margin-bottom: 30px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
                <div class="metric-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    <div class="metric-number" id="highAPIFields">12</div>
                    <div class="metric-label">High API Gravity (>30°)</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    <div class="metric-number" id="optimalBHTFields">8</div>
                    <div class="metric-label">Optimal BHT (<190°F)</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #27ae60, #229954);">
                    <div class="metric-number" id="activeFields">23</div>
                    <div class="metric-label">Active Fields</div>
                </div>
                <div class="metric-card" style="background: linear-gradient(135deg, #8e44ad, #7d3c98);">
                    <div class="metric-number" id="avgProduction">52,000</div>
                    <div class="metric-label">Avg Production (BBL/d)</div>
                </div>
            </div>
            
            <div style="overflow-x: auto;">
                <table class="excel-table" id="fieldsTable">
                    <thead>
                        <tr>
                            <th>Field Name</th>
                            <th>Operator</th>
                            <th>Location</th>
                            <th>Production (BBL/d)</th>
                            <th>API Gravity</th>
                            <th>BHT (°F)</th>
                            <th>Water Cut</th>
                            <th>Lifting Costs</th>
                            <th>OOR Suitability</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="fieldsTableBody">
                        <!-- Demo data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- New Contacts Tab -->
        <div id="contacts" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>📞 Industry Contact Database</h3>
                <button class="btn btn-primary" onclick="showAddContactModal()">
                    ➕ Add New Contact
                </button>
            </div>
            
            <div class="filter-controls">
                <input type="text" id="contactSearch" class="filter-input" placeholder="Search contacts..." onkeyup="filterContacts()">
                <select id="companyFilter" class="filter-input" onchange="filterContacts()">
                    <option value="">All Companies</option>
                    <option value="Equinor">Equinor</option>
                    <option value="BP">BP</option>
                    <option value="Shell">Shell</option>
                    <option value="TotalEnergies">TotalEnergies</option>
                </select>
                <button class="filter-btn" onclick="clearContactFilters()">Clear Filters</button>
            </div>
            
            <table class="excel-table" id="contactsTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Company</th>
                        <th>Position</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>LinkedIn</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="contactsTableBody">
                    <!-- Demo data will be populated here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Company Research Modal -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <h3 id="companyModalTitle">Company Research Profile</h3>
            <div id="companyModalContent">
                <!-- Dynamic company research content -->
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="closeModal('companyModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Intern Profile Modal -->
    <div id="internModal" class="modal">
        <div class="modal-content">
            <h3 id="internModalTitle">Intern Profile</h3>
            <div id="internModalContent">
                <!-- Dynamic intern profile content -->
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="closeModal('internModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Field Details Modal -->
    <div id="fieldModal" class="modal">
        <div class="modal-content">
            <h3 id="fieldModalTitle">Field Details</h3>
            <div id="fieldModalContent">
                <!-- Dynamic field details content -->
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="closeModal('fieldModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Contact Details Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <h3 id="contactModalTitle">Contact Details</h3>
            <div id="contactModalContent">
                <!-- Dynamic contact details content -->
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-secondary" onclick="closeModal('contactModal')">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Edit Entry</h3>
            <form id="editForm">
                <input type="hidden" id="editRowIndex">
                <input type="hidden" id="editSheetName">
                
                <div id="formFields">
                    <!-- Dynamic form fields will be generated here -->
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Global variables
        let workbook = null;
        let excelData = {
            companies: [],
            interns: [],
            fields: [],
            contacts: []
        };
        
        // Enhanced demo data for Tigbourne Capital
        const demoMode = true;
        
        if (demoMode) {
            // Enhanced Companies Data
            excelData.companies = [
                {
                    Company_Name: "Equinor ASA",
                    Production_BBL: 340000,
                    Ownership: "Norwegian Government (67%), Public (33%)",
                    Recent_MA: "Merger with Shell assets, renewable acquisitions",
                    Priority: "High",
                    Assigned_To: "Justin",
                    Proposal_Status: "Done",
                    Investment_Thesis: "Leading North Sea operator with Johan Sverdrup field. Strong ESG profile and renewable transition strategy.",
                    Next_Steps: "Follow up on Q2 2025 results, assess renewable energy partnerships"
                },
                {
                    Company_Name: "Aker BP",
                    Production_BBL: 200000,
                    Ownership: "Aker (40%), BP (30%), Public (30%)",
                    Recent_MA: "Leading Norwegian independent, recent Lundin Energy merger",
                    Priority: "High",
                    Assigned_To: "Justin",
                    Proposal_Status: "Done",
                    Investment_Thesis: "Efficient Norwegian operator, strong cash flows, disciplined capital allocation",
                    Next_Steps: "Monitor Yggdrasil development, review 2025 guidance"
                },
                {
                    Company_Name: "TotalEnergies",
                    Production_BBL: 170000,
                    Ownership: "Institutional (57%), Public (43%)",
                    Recent_MA: "$900M Sapura OMV assets, VSB group acquisition",
                    Priority: "High",
                    Assigned_To: "Jack",
                    Proposal_Status: "Pending",
                    Investment_Thesis: "Integrated energy major with strong North Sea portfolio. Good ESG positioning.",
                    Next_Steps: "Complete financial model, schedule management call"
                },
                {
                    Company_Name: "NEO Energy",
                    Production_BBL: 85000,
                    Ownership: "HitecVision (Private Equity)",
                    Recent_MA: "ExxonMobil North Sea assets acquisition, Repsol UK merger pending",
                    Priority: "High",
                    Assigned_To: "David",
                    Proposal_Status: "In Progress",
                    Investment_Thesis: "Rapid consolidator in UKCS, strong operational track record, attractive asset base",
                    Next_Steps: "Analyze NEO NEXT merger implications, update valuation"
                },
                {
                    Company_Name: "Serica Energy",
                    Production_BBL: 45000,
                    Ownership: "Public Company",
                    Recent_MA: "Tailwind Energy assets, focus on UK North Sea",
                    Priority: "Medium",
                    Assigned_To: "George",
                    Proposal_Status: "Research",
                    Investment_Thesis: "UK-focused independent with Bruce field, active in late-life asset optimization",
                    Next_Steps: "Complete technical due diligence on Columbus field"
                }
            ];
            
            // Enhanced Interns Data
            excelData.interns = [
                { 
                    Name: "Jack Richardson", 
                    Total_Companies: 6, 
                    Total_Fields: 2, 
                    Proposals_Done: 3, 
                    Workload_Status: "Company Focus",
                    Specialization: "Financial Modeling, M&A Analysis"
                },
                { 
                    Name: "David Mitchell", 
                    Total_Companies: 4, 
                    Total_Fields: 8, 
                    Proposals_Done: 2, 
                    Workload_Status: "Well Balanced",
                    Specialization: "Technical Analysis, Reservoir Engineering"
                },
                { 
                    Name: "Justin Parker", 
                    Total_Companies: 8, 
                    Total_Fields: 15, 
                    Proposals_Done: 4, 
                    Workload_Status: "Overloaded",
                    Specialization: "Deal Origination, Industry Relationships"
                },
                { 
                    Name: "George Thompson", 
                    Total_Companies: 3, 
                    Total_Fields: 5, 
                    Proposals_Done: 1, 
                    Workload_Status: "Available",
                    Specialization: "ESG Analysis, Regulatory Affairs"
                }
            ];
            
            // Enhanced Oil Fields Data
            excelData.fields = [
                {
                    "Field Name": "Johan Sverdrup",
                    "Operator & Partners": "Equinor (Operator, 42.6%), Lundin (20%), Petoro (17.36%)",
                    "Location": "Norwegian North Sea",
                    "Gross Production (Current/Recent)": "755,000 bbl/d",
                    "API Gravity": "31.5°",
                    "BHT (Bottom Hole Temperature)": "178°F",
                    "Water Cut": "15%",
                    "Estimated Lifting Costs": "$3–5/boe",
                    "OOR Applicability": "Excellent - High API, optimal BHT, low water cut",
                    "Strategic Value": "World-class asset, 40-year field life, low-cost production"
                },
                {
                    "Field Name": "Forties",
                    "Operator & Partners": "Apache North Sea Limited (Operator, 97% WI), Ithaca (3%)",
                    "Location": "Central North Sea, 110 miles east of Aberdeen",
                    "Gross Production (Current/Recent)": "16,000 bbl/d",
                    "API Gravity": "36.5°",
                    "BHT (Bottom Hole Temperature)": "200°F",
                    "Water Cut": "85-90%",
                    "Estimated Lifting Costs": "$25–35/boe",
                    "OOR Applicability": "Good - High API gravity, manageable BHT despite high water cut",
                    "Strategic Value": "Historic major field, late-life optimization opportunities"
                },
                {
                    "Field Name": "Buzzard",
                    "Operator & Partners": "Chrysaor Holdings Limited (100%)",
                    "Location": "UK Central North Sea",
                    "Gross Production (Current/Recent)": "45,000 bbl/d",
                    "API Gravity": "33.2°",
                    "BHT (Bottom Hole Temperature)": "185°F",
                    "Water Cut": "75%",
                    "Estimated Lifting Costs": "$18–25/boe",
                    "OOR Applicability": "Excellent - Optimal API/BHT combination for OOR technology",
                    "Strategic Value": "Key UK production hub, infrastructure advantage"
                },
                {
                    "Field Name": "Schiehallion",
                    "Operator & Partners": "BP (Operator, 33.3%), Shell (33.3%), OMV (33.3%)",
                    "Location": "West of Shetland",
                    "Gross Production (Current/Recent)": "77,000 bbl/d",
                    "API Gravity": "25.2°",
                    "BHT (Bottom Hole Temperature)": "156°F",
                    "Water Cut": ">85%",
                    "Estimated Lifting Costs": "$20–30/boe",
                    "OOR Applicability": "Good - Optimal BHT, moderate API gravity",
                    "Strategic Value": "FPSO-based production, deep water expertise"
                }
            ];
            
            // New Contacts Data
            excelData.contacts = [
                {
                    Name: "Lars Bender",
                    Company: "Equinor ASA",
                    Position: "VP North Sea Operations",
                    Email: "lars.bender@equinor.com",
                    Phone: "+47 51 99 00 00",
                    LinkedIn: "linkedin.com/in/larsbender",
                    Notes: "Key contact for Johan Sverdrup discussions"
                },
                {
                    Name: "Sarah Mitchell",
                    Company: "NEO Energy",
                    Position: "Head of Business Development",
                    Email: "sarah.mitchell@neo-energy.com",
                    Phone: "+44 20 3966 3840",
                    LinkedIn: "linkedin.com/in/sarahmitchellnorth",
                    Notes: "Primary contact for NEO acquisition opportunities"
                },
                {
                    Name: "David Thompson",
                    Company: "Aker BP",
                    Position: "Chief Financial Officer",
                    Email: "david.thompson@akerbp.com",
                    Phone: "+47 67 50 40 00",
                    LinkedIn: "linkedin.com/in/davidthompsonakerbp",
                    Notes: "Finance lead for partnership discussions"
                },
                {
                    Name: "Emma Roberts",
                    Company: "Serica Energy",
                    Position: "Technical Director",
                    Email: "emma.roberts@serica-energy.com",
                    Phone: "+44 20 7487 7300",
                    LinkedIn: "linkedin.com/in/emmarobertsserica",
                    Notes: "Technical expert on Bruce field optimization"
                }
            ];
        }
        
        // File upload handler
        document.getElementById('excelFile').addEventListener('change', handleFileUpload);
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    workbook = XLSX.read(e.target.result, { type: 'binary' });
                    processExcelFile(file);
                    updateFileStatus('connected', `Connected: ${file.name}`);
                    document.getElementById('refreshBtn').disabled = false;
                } catch (error) {
                    alert('Error reading Excel file: ' + error.message);
                    updateFileStatus('disconnected', 'Error loading file');
                }
            };
            reader.readAsBinaryString(file);
        }
        
        function processExcelFile(file) {
            // Display file info
            document.getElementById('fileInfo').style.display = 'block';
            document.getElementById('fileName').textContent = `File: ${file.name}`;
            document.getElementById('fileSize').textContent = `Size: ${(file.size / 1024).toFixed(2)} KB`;
            document.getElementById('sheetsInfo').textContent = `Sheets: ${workbook.SheetNames.join(', ')}`;
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
            
            // Process each sheet
            try {
                // Companies sheet
                if (workbook.SheetNames.includes('Companies')) {
                    const companiesSheet = workbook.Sheets['Companies'];
                    excelData.companies = XLSX.utils.sheet_to_json(companiesSheet);
                }
                
                // Interns sheet
                if (workbook.SheetNames.includes('Interns')) {
                    const internsSheet = workbook.Sheets['Interns'];
                    excelData.interns = XLSX.utils.sheet_to_json(internsSheet);
                }
                
                // Oil Fields sheet
                const oilFieldsSheetNames = ['Oil_Fields', 'Oil Fields', 'Fields', 'Oilfields'];
                const foundOilFieldsSheet = workbook.SheetNames.find(name => 
                    oilFieldsSheetNames.some(possible => 
                        name.toLowerCase().includes(possible.toLowerCase())
                    )
                );
                
                if (foundOilFieldsSheet) {
                    const fieldsSheet = workbook.Sheets[foundOilFieldsSheet];
                    excelData.fields = XLSX.utils.sheet_to_json(fieldsSheet);
                }
                
                // Contacts sheet
                if (workbook.SheetNames.includes('Contacts')) {
                    const contactsSheet = workbook.Sheets['Contacts'];
                    excelData.contacts = XLSX.utils.sheet_to_json(contactsSheet);
                }
                
                // Update dashboard
                updateDashboard();
                
            } catch (error) {
                console.error('Error processing Excel data:', error);
                alert('Error processing Excel data. Please check the file format.');
            }
        }
        
        function updateDashboard() {
            updateMetrics();
            updateCompaniesTable();
            updateInternsTable();
            updateInternProfiles();
            updateFieldsTable();
            updateContactsTable();
        }
        
        function updateMetrics() {
            const companies = excelData.companies;
            const fields = excelData.fields;
            const contacts = excelData.contacts;
            
            // Company metrics
            const totalCompanies = companies.length;
            const assignedCompanies = companies.filter(c => c.Assigned_To && c.Assigned_To !== '').length;
            const proposalsDone = companies.filter(c => c.Proposal_Status === 'Done' || c.Proposal_Status === 'done').length;
            const completionRate = totalCompanies > 0 ? Math.round((proposalsDone / totalCompanies) * 100) : 0;
            const highPriorityDeals = companies.filter(c => c.Priority === 'High').length;
            
            // Field metrics
            const totalFields = fields.length;
            const oorCandidates = fields.filter(f => {
                const oorText = (f['OOR Applicability'] || '').toLowerCase();
                return oorText.includes('excellent') || oorText.includes('good') || oorText.includes('fit');
            }).length;
            
            // Update DOM
            document.getElementById('totalCompanies').textContent = totalCompanies;
            document.getElementById('totalFields').textContent = totalFields;
            document.getElementById('assignedCompanies').textContent = assignedCompanies;
            document.getElementById('proposalsDone').textContent = proposalsDone;
            document.getElementById('completionRate').textContent = completionRate + '%';
            document.getElementById('oorCandidates').textContent = oorCandidates;
            document.getElementById('totalContacts').textContent = contacts.length;
            document.getElementById('highPriorityDeals').textContent = highPriorityDeals;
        }
        
        function updateCompaniesTable() {
            const tbody = document.getElementById('companiesTableBody');
            tbody.innerHTML = '';
            
            excelData.companies.forEach((company, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="company-name-cell" onclick="showCompanyProfile(${index})">
                            <strong>${company.Company_Name || ''}</strong>
                        </span>
                    </td>
                    <td>${formatNumber(company.Production_BBL)}</td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${company.Ownership || ''}</td>
                    <td><span class="priority-badge priority-${(company.Priority || '').toLowerCase()}">${company.Priority || ''}</span></td>
                    <td>${company.Assigned_To || 'Unassigned'}</td>
                    <td>${company.Proposal_Status || 'Pending'}</td>
                    <td>
                        <button class="research-btn" onclick="showCompanyProfile(${index})">🔍 Research</button>
                        <button class="edit-btn" onclick="editRow('companies', ${index})">✏️ Edit</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateInternsTable() {
            const tbody = document.getElementById('internsTableBody');
            tbody.innerHTML = '';
            
            excelData.interns.forEach((intern, index) => {
                const totalWork = (intern.Total_Companies || 0) + (intern.Total_Fields || 0);
                const workloadLevel = getWorkloadLevel(totalWork);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="intern-name-cell" onclick="showInternProfile(${index})">
                            <strong>${intern.Name || ''}</strong>
                        </span>
                    </td>
                    <td>${intern.Total_Companies || 0}</td>
                    <td>${intern.Total_Fields || 0}</td>
                    <td>${intern.Proposals_Done || 0}</td>
                    <td>
                        <div class="intern-workload-visual">
                            <div class="workload-bar">
                                <div class="workload-fill workload-${workloadLevel.class}" style="width: ${workloadLevel.percentage}%"></div>
                            </div>
                            <span class="workload-badge workload-${getWorkloadBadgeClass(intern.Workload_Status)}">
                                ${intern.Workload_Status || 'Available'}
                            </span>
                        </div>
                    </td>
                    <td style="font-size: 0.85rem;">${intern.Specialization || 'General'}</td>
                    <td>
                        <button class="edit-btn" onclick="editRow('interns', ${index})">✏️ Edit</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateInternProfiles() {
            const container = document.getElementById('internProfiles');
            container.innerHTML = '';
            
            excelData.interns.forEach((intern, index) => {
                const totalWork = (intern.Total_Companies || 0) + (intern.Total_Fields || 0);
                const completionRate = totalWork > 0 ? Math.round(((intern.Proposals_Done || 0) / totalWork) * 100) : 0;
                
                const profileCard = document.createElement('div');
                profileCard.className = 'intern-profile-section';
                profileCard.innerHTML = `
                    <h4 style="color: #2563eb; cursor: pointer;" onclick="showInternProfile(${index})">
                        👤 ${intern.Name || 'Unknown'}
                    </h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                        <div class="detail-item">
                            <span class="detail-label">Total Assignments:</span>
                            <span class="detail-value">${totalWork}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Completion Rate:</span>
                            <span class="detail-value">${completionRate}%</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="workload-badge workload-${getWorkloadBadgeClass(intern.Workload_Status)}">
                                    ${intern.Workload_Status || 'Available'}
                                </span>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Specialization:</span>
                            <span class="detail-value">${intern.Specialization || 'General'}</span>
                        </div>
                    </div>
                `;
                container.appendChild(profileCard);
            });
        }
        
        function updateFieldsTable() {
            const tbody = document.getElementById('fieldsTableBody');
            tbody.innerHTML = '';
            
            excelData.fields.forEach((field, index) => {
                // Extract and format key data
                const fieldName = field['Field Name'] || '';
                const operator = field['Operator & Partners'] || '';
                const location = field['Location'] || '';
                const production = field['Gross Production (Current/Recent)'] || '';
                const apiGravity = field['API Gravity'] || '';
                const bht = field['BHT (Bottom Hole Temperature)'] || '';
                const waterCut = field['Water Cut'] || '';
                const liftingCosts = field['Estimated Lifting Costs'] || '';
                const oorApplicability = field['OOR Applicability'] || '';
                
                // Parse numeric values for styling
                const productionMatch = production.toString().match(/(\d+(?:,\d+)*)/);
                const productionValue = productionMatch ? parseInt(productionMatch[1].replace(/,/g, '')) : 0;
                
                const apiMatch = apiGravity.toString().match(/(\d+\.?\d*)/);
                const apiValue = apiMatch ? parseFloat(apiMatch[1]) : 0;
                
                const bhtMatch = bht.toString().match(/(\d+)/);
                const bhtValue = bhtMatch ? parseFloat(bhtMatch[1]) : 0;
                
                // Determine styling classes
                const productionClass = productionValue > 100000 ? 'high-production' : 
                                      productionValue > 30000 ? 'medium-production' : 'low-production';
                
                const apiClass = apiValue > 30 ? 'high-api' : 
                               apiValue > 20 ? 'medium-api' : 'low-api';
                
                const bhtClass = bhtValue < 190 ? 'optimal-bht' : 'high-bht';
                
                // OOR suitability badge
                const oorText = oorApplicability.toLowerCase();
                let oorBadge = '';
                if (oorText.includes('excellent')) {
                    oorBadge = '<span class="oor-badge oor-excellent">Excellent</span>';
                } else if (oorText.includes('good')) {
                    oorBadge = '<span class="oor-badge oor-good">Good</span>';
                } else if (oorText.includes('limited') || oorText.includes('challenging')) {
                    oorBadge = '<span class="oor-badge oor-limited">Limited</span>';
                } else {
                    oorBadge = '<span class="oor-badge oor-poor">TBD</span>';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="field-name-cell" onclick="showFieldProfile(${index})">
                            <strong>${fieldName}</strong>
                        </span>
                    </td>
                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${operator}">
                        ${operator.length > 30 ? operator.substring(0, 30) + '...' : operator}
                    </td>
                    <td style="font-size: 0.85rem;">${location.length > 25 ? location.substring(0, 25) + '...' : location}</td>
                    <td class="production-cell ${productionClass}">
                        ${productionMatch ? formatNumber(productionValue) : production}
                    </td>
                    <td class="api-cell ${apiClass}">
                        ${apiValue > 0 ? apiValue + '°' : apiGravity}
                    </td>
                    <td class="bht-cell ${bhtClass}">
                        ${bhtValue > 0 ? bhtValue + '°F' : bht}
                    </td>
                    <td style="font-size: 0.85rem;">${waterCut}</td>
                    <td style="font-size: 0.85rem;">${liftingCosts}</td>
                    <td>${oorBadge}</td>
                    <td>
                        <button class="edit-btn" onclick="editRow('fields', ${index})" title="Edit Field">
                            ✏️
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateContactsTable() {
            const tbody = document.getElementById('contactsTableBody');
            tbody.innerHTML = '';
            
            excelData.contacts.forEach((contact, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="contact-name-cell" onclick="showContactProfile(${index})">
                            <strong>${contact.Name || ''}</strong>
                        </span>
                    </td>
                    <td>${contact.Company || ''}</td>
                    <td>${contact.Position || ''}</td>
                    <td>
                        <a href="mailto:${contact.Email || ''}" class="clickable-link">
                            ${contact.Email || ''}
                        </a>
                    </td>
                    <td>
                        <a href="tel:${contact.Phone || ''}" class="clickable-link">
                            ${contact.Phone || ''}
                        </a>
                    </td>
                    <td>
                        <a href="https://${contact.LinkedIn || ''}" target="_blank" class="clickable-link">
                            ${contact.LinkedIn ? '🔗 LinkedIn' : ''}
                        </a>
                    </td>
                    <td>
                        <button class="edit-btn" onclick="editRow('contacts', ${index})">✏️ Edit</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Modal Functions
        function showCompanyProfile(index) {
            const company = excelData.companies[index];
            const relatedFields = excelData.fields.filter(field => 
                (field['Operator & Partners'] || '').toLowerCase().includes(company.Company_Name.toLowerCase())
            );
            
            const modalTitle = document.getElementById('companyModalTitle');
            const modalContent = document.getElementById('companyModalContent');
            
            modalTitle.textContent = `${company.Company_Name} - Investment Research`;
            
            modalContent.innerHTML = `
                <div class="company-profile-section">
                    <h4>📈 Investment Overview</h4>
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h4>💰 Financial Metrics</h4>
                            <div class="detail-item">
                                <span class="detail-label">Production:</span>
                                <span class="detail-value">${formatNumber(company.Production_BBL)} BBL/d</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Priority Level:</span>
                                <span class="detail-value">
                                    <span class="priority-badge priority-${(company.Priority || '').toLowerCase()}">
                                        ${company.Priority}
                                    </span>
                                </span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Proposal Status:</span>
                                <span class="detail-value">${company.Proposal_Status}</span>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4>🏢 Ownership Structure</h4>
                            <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                                ${company.Ownership}
                            </p>
                        </div>
                        
                        <div class="detail-section">
                            <h4>🎯 Investment Thesis</h4>
                            <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                                ${company.Investment_Thesis || 'Investment thesis to be developed'}
                            </p>
                        </div>
                        
                        <div class="detail-section">
                            <h4>📋 Recent M&A Activity</h4>
                            <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                                ${company.Recent_MA || 'No recent M&A activity'}
                            </p>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>🛢️ Related Oil Fields (${relatedFields.length})</h4>
                        ${relatedFields.length > 0 ? 
                            relatedFields.map(field => `
                                <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px;">
                                    <strong>${field['Field Name']}</strong> - ${field['Gross Production (Current/Recent)']} BBL/d
                                    <br><small style="color: #6c757d;">API: ${field['API Gravity']} | BHT: ${field['BHT (Bottom Hole Temperature)']} | OOR: ${field['OOR Applicability']}</small>
                                </div>
                            `).join('') : 
                            '<p style="color: #6c757d; font-style: italic;">No operated fields found in database</p>'
                        }
                    </div>
                    
                    <div class="detail-section">
                        <h4>🚀 Next Steps & Action Items</h4>
                        <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                            ${company.Next_Steps || 'Next steps to be defined'}
                        </p>
                        <div style="margin-top: 15px;">
                            <strong>Assigned To:</strong> <span style="color: #2563eb;">${company.Assigned_To || 'Unassigned'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('companyModal').style.display = 'block';
        }
        
        function showInternProfile(index) {
            const intern = excelData.interns[index];
            const assignedCompanies = excelData.companies.filter(c => c.Assigned_To === intern.Name);
            const totalWork = (intern.Total_Companies || 0) + (intern.Total_Fields || 0);
            const completionRate = totalWork > 0 ? Math.round(((intern.Proposals_Done || 0) / totalWork) * 100) : 0;
            
            const modalTitle = document.getElementById('internModalTitle');
            const modalContent = document.getElementById('internModalContent');
            
            modalTitle.textContent = `${intern.Name} - Team Member Profile`;
            
            modalContent.innerHTML = `
                <div class="intern-profile-section">
                    <div class="detail-grid">
                        <div class="detail-section">
                            <h4>📊 Workload Overview</h4>
                            <div class="detail-item">
                                <span class="detail-label">Total Companies:</span>
                                <span class="detail-value">${intern.Total_Companies || 0}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Total Fields:</span>
                                <span class="detail-value">${intern.Total_Fields || 0}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Proposals Completed:</span>
                                <span class="detail-value">${intern.Proposals_Done || 0}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Completion Rate:</span>
                                <span class="detail-value">${completionRate}%</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Current Status:</span>
                                <span class="detail-value">
                                    <span class="workload-badge workload-${getWorkloadBadgeClass(intern.Workload_Status)}">
                                        ${intern.Workload_Status || 'Available'}
                                    </span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4>🎯 Specialization & Skills</h4>
                            <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                                <strong>Primary Focus:</strong> ${intern.Specialization || 'General Analysis'}
                            </p>
                            <div style="margin-top: 15px;">
                                <div class="intern-workload-visual">
                                    <span style="font-size: 0.9rem; color: #495057;">Workload Level:</span>
                                    <div class="workload-bar" style="margin-left: 10px;">
                                        <div class="workload-fill workload-${getWorkloadLevel(totalWork).class}" 
                                             style="width: ${getWorkloadLevel(totalWork).percentage}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h4>🏢 Assigned Companies (${assignedCompanies.length})</h4>
                            ${assignedCompanies.length > 0 ? 
                                assignedCompanies.map(company => `
                                    <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 5px; border-left: 3px solid #3498db;">
                                        <strong>${company.Company_Name}</strong>
                                        <span class="priority-badge priority-${(company.Priority || '').toLowerCase()}" style="margin-left: 10px; font-size: 0.7rem;">
                                            ${company.Priority}
                                        </span>
                                        <br><small style="color: #6c757d;">Status: ${company.Proposal_Status} | Production: ${formatNumber(company.Production_BBL)} BBL/d</small>
                                    </div>
                                `).join('') : 
                                '<p style="color: #6c757d; font-style: italic;">No companies currently assigned</p>'
                            }
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>📈 Performance Insights</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 15px;">
                            <div style="text-align: center; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #2563eb;">${completionRate}%</div>
                                <div style="font-size: 0.8rem; color: #495057;">Completion Rate</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #0ea5e9;">${totalWork}</div>
                                <div style="font-size: 0.8rem; color: #495057;">Total Assignments</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #ecfdf5; border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #10b981;">${intern.Proposals_Done || 0}</div>
                                <div style="font-size: 0.8rem; color: #495057;">Completed</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('internModal').style.display = 'block';
        }
        
        function showFieldProfile(index) {
            const field = excelData.fields[index];
            
            const modalTitle = document.getElementById('fieldModalTitle');
            const modalContent = document.getElementById('fieldModalContent');
            
            modalTitle.textContent = `${field['Field Name']} - Field Analysis`;
            
            // Parse API and BHT for OOR assessment
            const apiMatch = (field['API Gravity'] || '').toString().match(/(\d+\.?\d*)/);
            const apiValue = apiMatch ? parseFloat(apiMatch[1]) : 0;
            const bhtMatch = (field['BHT (Bottom Hole Temperature)'] || '').toString().match(/(\d+)/);
            const bhtValue = bhtMatch ? parseFloat(bhtMatch[1]) : 0;
            
            let oorAssessment = "Assessment pending";
            if (apiValue > 30 && bhtValue < 200) {
                oorAssessment = "Excellent candidate - High API gravity and optimal BHT for OOR technology";
            } else if (apiValue > 25 && bhtValue < 250) {
                oorAssessment = "Good candidate - Suitable parameters for OOR with proper engineering";
            } else if (apiValue > 20) {
                oorAssessment = "Limited potential - May require advanced OOR techniques";
            } else {
                oorAssessment = "Poor candidate - Technical challenges expected";
            }
            
            modalContent.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-section">
                        <h4>🏢 Operational Details</h4>
                        <div class="detail-item">
                            <span class="detail-label">Operator & Partners:</span>
                            <span class="detail-value">${field['Operator & Partners'] || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Location:</span>
                            <span class="detail-value">${field['Location'] || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Current Production:</span>
                            <span class="detail-value">${field['Gross Production (Current/Recent)'] || 'N/A'}</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>🔬 Technical Parameters</h4>
                        <div class="detail-item">
                            <span class="detail-label">API Gravity:</span>
                            <span class="detail-value" style="color: ${apiValue > 30 ? '#16a34a' : apiValue > 20 ? '#d97706' : '#dc2626'};">
                                ${field['API Gravity'] || 'N/A'}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">BHT:</span>
                            <span class="detail-value" style="color: ${bhtValue < 190 ? '#16a34a' : '#dc2626'};">
                                ${field['BHT (Bottom Hole Temperature)'] || 'N/A'}
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Water Cut:</span>
                            <span class="detail-value">${field['Water Cut'] || 'N/A'}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Lifting Costs:</span>
                            <span class="detail-value">${field['Estimated Lifting Costs'] || 'N/A'}</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>🎯 OOR Technology Assessment</h4>
                        <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;">
                            <strong>Current Assessment:</strong>
                            <p style="margin: 10px 0; line-height: 1.6; color: #495057;">
                                ${field['OOR Applicability'] || 'No assessment available'}
                            </p>
                        </div>
                        <div style="padding: 15px; background: #e7f3ff; border-radius: 8px;">
                            <strong>Tigbourne Analysis:</strong>
                            <p style="margin: 10px 0; line-height: 1.6; color: #004085;">
                                ${oorAssessment}
                            </p>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>💼 Strategic Value</h4>
                        <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                            ${field['Strategic Value'] || 'Strategic assessment to be completed'}
                        </p>
                        <div style="margin-top: 15px;">
                            <strong>Investment Priority:</strong> 
                            <span style="color: ${apiValue > 30 && bhtValue < 200 ? '#16a34a' : '#d97706'};">
                                ${apiValue > 30 && bhtValue < 200 ? 'High - Strong OOR candidate' : 'Medium - Requires further analysis'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('fieldModal').style.display = 'block';
        }
        
        function showContactProfile(index) {
            const contact = excelData.contacts[index];
            
            const modalTitle = document.getElementById('contactModalTitle');
            const modalContent = document.getElementById('contactModalContent');
            
            modalTitle.textContent = `${contact.Name} - Contact Details`;
            
            modalContent.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-section">
                        <h4>👤 Contact Information</h4>
                        <div class="detail-item">
                            <span class="detail-label">Full Name:</span>
                            <span class="detail-value"><strong>${contact.Name}</strong></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Company:</span>
                            <span class="detail-value">${contact.Company}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Position:</span>
                            <span class="detail-value">${contact.Position}</span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>📞 Contact Methods</h4>
                        <div class="detail-item">
                            <span class="detail-label">Email:</span>
                            <span class="detail-value">
                                <a href="mailto:${contact.Email}" class="clickable-link">${contact.Email}</a>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Phone:</span>
                            <span class="detail-value">
                                <a href="tel:${contact.Phone}" class="clickable-link">${contact.Phone}</a>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">LinkedIn:</span>
                            <span class="detail-value">
                                <a href="https://${contact.LinkedIn}" target="_blank" class="clickable-link">
                                    View Profile →
                                </a>
                            </span>
                        </div>
                    </div>
                    
                    <div class="detail-section">
                        <h4>📝 Notes & Context</h4>
                        <p style="line-height: 1.6; color: #495057; margin: 10px 0;">
                            ${contact.Notes || 'No notes available'}
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('contactModal').style.display = 'block';
        }
        
        // Utility Functions
        function getWorkloadLevel(totalWork) {
            if (totalWork >= 20) return { class: 'high', percentage: 100 };
            if (totalWork >= 10) return { class: 'medium', percentage: 70 };
            return { class: 'low', percentage: 30 };
        }
        
        function getWorkloadBadgeClass(status) {
            const statusLower = (status || '').toLowerCase();
            if (statusLower.includes('overloaded')) return 'overloaded';
            if (statusLower.includes('focus') || statusLower.includes('company')) return 'focus';
            return 'balanced';
        }
        
        // Filter Functions
        function filterCompanies() {
            const searchTerm = document.getElementById('companySearch').value.toLowerCase();
            const priorityFilter = document.getElementById('priorityFilter').value;
            const table = document.getElementById('companiesTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const companyName = row.cells[0].textContent.toLowerCase();
                const priority = row.cells[3].textContent;
                
                const matchesSearch = companyName.includes(searchTerm);
                const matchesPriority = !priorityFilter || priority.includes(priorityFilter);
                
                row.style.display = (matchesSearch && matchesPriority) ? '' : 'none';
            });
        }
        
        function clearCompanyFilters() {
            document.getElementById('companySearch').value = '';
            document.getElementById('priorityFilter').value = '';
            filterCompanies();
        }
        
        function filterFields() {
            const searchTerm = document.getElementById('fieldSearch').value.toLowerCase();
            const apiFilter = document.getElementById('apiFilter').value;
            const table = document.getElementById('fieldsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const fieldName = row.cells[0].textContent.toLowerCase();
                const apiText = row.cells[4].textContent;
                
                const matchesSearch = fieldName.includes(searchTerm);
                let matchesAPI = true;
                
                if (apiFilter) {
                    const apiMatch = apiText.match(/(\d+\.?\d*)/);
                    const apiValue = apiMatch ? parseFloat(apiMatch[1]) : 0;
                    
                    if (apiFilter === 'high') matchesAPI = apiValue > 30;
                    if (apiFilter === 'medium') matchesAPI = apiValue >= 20 && apiValue <= 30;
                    if (apiFilter === 'low') matchesAPI = apiValue < 20;
                }
                
                row.style.display = (matchesSearch && matchesAPI) ? '' : 'none';
            });
        }
        
        function clearFieldFilters() {
            document.getElementById('fieldSearch').value = '';
            document.getElementById('apiFilter').value = '';
            filterFields();
        }
        
        function filterContacts() {
            const searchTerm = document.getElementById('contactSearch').value.toLowerCase();
            const companyFilter = document.getElementById('companyFilter').value;
            const table = document.getElementById('contactsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const contactName = row.cells[0].textContent.toLowerCase();
                const company = row.cells[1].textContent;
                
                const matchesSearch = contactName.includes(searchTerm);
                const matchesCompany = !companyFilter || company.includes(companyFilter);
                
                row.style.display = (matchesSearch && matchesCompany) ? '' : 'none';
            });
        }
        
        function clearContactFilters() {
            document.getElementById('contactSearch').value = '';
            document.getElementById('companyFilter').value = '';
            filterContacts();
        }
        
        function filterOORCandidates() {
            const table = document.getElementById('fieldsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const oorCell = row.cells[8];
                const oorText = oorCell.textContent.toLowerCase();
                
                if (oorText.includes('excellent') || oorText.includes('good')) {
                    row.style.display = '';
                    row.style.backgroundColor = '#fff3cd';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function filterHighWaterCut() {
            const table = document.getElementById('fieldsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                const waterCutText = row.cells[6].textContent;
                const waterCutMatch = waterCutText.match(/(\d+)/);
                const waterCutValue = waterCutMatch ? parseInt(waterCutMatch[1]) : 0;
                
                if (waterCutValue > 70) {
                    row.style.display = '';
                    row.style.backgroundColor = '#f8d7da';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        function showAllFields() {
            const table = document.getElementById('fieldsTable');
            const rows = table.querySelectorAll('tbody tr');
            
            rows.forEach(row => {
                row.style.display = '';
                row.style.backgroundColor = '';
            });
        }
        
        // Edit and Modal Functions
        function editRow(sheetType, rowIndex) {
            // Placeholder for edit functionality
            alert(`Edit functionality would open here for ${sheetType} row ${rowIndex}. Upload your Excel file to enable full editing capabilities!`);
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function refreshData() {
            if (workbook) {
                updateDashboard();
                updateFileStatus('connected', 'Data refreshed');
            }
        }
        
        function downloadExcel() {
            if (!workbook) {
                alert('Please upload an Excel file first');
                return;
            }
            
            try {
                // Update workbook with modified data
                if (excelData.companies.length > 0) {
                    const companiesSheet = XLSX.utils.json_to_sheet(excelData.companies);
                    workbook.Sheets['Companies'] = companiesSheet;
                }
                
                if (excelData.interns.length > 0) {
                    const internsSheet = XLSX.utils.json_to_sheet(excelData.interns);
                    workbook.Sheets['Interns'] = internsSheet;
                }
                
                if (excelData.fields.length > 0) {
                    const fieldsSheet = XLSX.utils.json_to_sheet(excelData.fields);
                    workbook.Sheets['Oil_Fields'] = fieldsSheet;
                }
                
                if (excelData.contacts.length > 0) {
                    const contactsSheet = XLSX.utils.json_to_sheet(excelData.contacts);
                    workbook.Sheets['Contacts'] = contactsSheet;
                }
                
                const timestamp = new Date().toISOString().slice(0, 10);
                XLSX.writeFile(workbook, `North_Sea_Track_Enhanced_${timestamp}.xlsx`);
                
            } catch (error) {
                console.error('Error downloading Excel file:', error);
                alert('Error creating Excel file: ' + error.message);
            }
        }
        
        function updateFileStatus(status, message) {
            const statusEl = document.getElementById('fileStatus');
            statusEl.className = `status-indicator status-${status}`;
            statusEl.textContent = message;
        }
        
        function formatNumber(num) {
            return num ? parseInt(num).toLocaleString() : '0';
        }
        
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        // Initialize demo dashboard
        if (demoMode) {
            updateDashboard();
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = ['companyModal', 'internModal', 'fieldModal', 'contactModal', 'editModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>